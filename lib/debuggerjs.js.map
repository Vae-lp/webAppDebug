{"version":3,"sources":["../src/debuggerjs.js"],"names":["DebuggerInstance","error","instance","errLocation","sendErrorData","create","me","needShow","count","Debugger","errorCount","timeStamp","Date","content","message","location","alertBox","document","createElement","id","className","debugger","innerHTML","body","appendChild","setTimeout","destroy","blur","then","parentNode","removeChild","timer","Promise","res","rej","setInterval","opacity","getCssValue","clearTimeout","style","needReport","url","method","errorObj","href","ua","navigator","userAgent","filename","getFileName","lineno","getLineNo","colno","getColNo","getLocation","data","target","attr","window","getComputedStyle","splitLocation","replace","rs","exec","RE","RegExp","$1","$2","$3","locationObj","obj","cssText","key","cssKey","toLowerCase","cssVal","confData","init","options","listenScriptError","addEventListener","log","arguments","isError","getStackMessage","stack","getStackLocation","isEvent","throwError","src","e","isErrorEvent","isXHR","isString","isUndefined","Error","stackArr","split","length","constructor","Event","ErrorEvent","isProgressEvent","ProgressEvent","XMLHttpRequest","Object","prototype","toString","call"],"mappings":"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","file":"debuggerjs.js","sourcesContent":["/**\n * Created by didi on 16/9/21.\n */\n\nimport styles from './debuggerjs.less';\nimport ajax from '@fdaciuk/ajax';\nimport objectAssign from 'object-assign';\n\nclass DebuggerInstance {\n    constructor(error) {\n        this.instance = null;\n        this.errLocation = {};\n\n\n        this.sendErrorData(error);\n        this.create(error);\n    }\n\n    getDefaultData() {\n\n    }\n\n    create(error) {\n        let me = this;\n        if (!error.needShow) return;\n\n        let count = Debugger.errorCount;\n        let timeStamp = +new Date();\n        let content = `\n            <div >err${count}: ${error.message}<br/>location: ${error.location}</div>\n            `;\n        let alertBox = document.createElement('div');\n        alertBox.id = 'debugger-' + timeStamp;\n        alertBox.className = styles.debugger;\n        alertBox.innerHTML = content;\n\n        me.instance = alertBox;\n\n        document.body.appendChild(alertBox);\n\n        Debugger.errorCount++;\n\n        setTimeout(function () {\n            me.destroy();\n        }, 10000)\n    }\n\n    destroy() {\n        let me = this;\n        me.blur()\n            .then(function () {\n                let instance = me.instance;\n                instance && instance.parentNode && instance.parentNode.removeChild(instance);\n            })\n    }\n\n    blur() {\n        let me = this,\n            instance = this.instance,\n            timer = null;\n\n        return new Promise(function (res, rej) {\n            timer = setInterval(function () {\n                let opacity = me.getCssValue(instance, 'opacity');\n                if (opacity < 0.1) {\n                    clearTimeout(timer);\n                    res()\n                } else {\n                    instance.style.opacity = opacity - 0.1\n                }\n            }, 50)\n        });\n\n    }\n\n    sendErrorData(error) {\n        if (!error.needReport) return;\n\n        const url = error.url;\n        const method = error.method;\n\n        let errorObj = {\n            url: location.href,\n            ua: navigator.userAgent,\n            filename: error.filename || this.getFileName(error.location),\n            lineno: error.lineno || this.getLineNo(error.location),\n            colno: error.colno || this.getColNo(error.location),\n            message: error.message || '',\n            location: this.getLocation(error.location) || ''\n        };\n        ajax({\n            url: url,\n            method: method,\n            data: errorObj\n        })\n    }\n\n    getCssValue(target, attr) {\n        return window.getComputedStyle(target)[attr]\n    }\n\n    getFileName(location) {\n        return this.errLocation.filename ? this.errLocation.filename : this.splitLocation(location).filename\n    }\n\n    getLineNo(location) {\n        return this.errLocation.lineno ? this.errLocation.lineno : this.splitLocation(location).lineno\n    }\n\n    getColNo(location) {\n        return this.errLocation.colno ? this.errLocation.colno : this.splitLocation(location).colno\n    }\n\n    getLocation(location) {\n        return location.replace(/\\s*(\\(.*\\))\\s*/, '')\n    }\n\n    splitLocation(location) {\n        const rs = /^.*\\((.*\\.js):(\\d*):(\\d*)\\)/.exec(location);\n        const RE = RegExp;\n        let [filename,lineno,colno] = [RE.$1, RE.$2, RE.$3];\n        this.locationObj = {filename, lineno, colno} // for cache\n        return this.locationObj\n    }\n\n    compileToCss(obj) {\n        let cssText = '';\n        for (let key in obj) {\n            let cssKey = key.replace(/([A-Z])/g, \"-$1\").toLowerCase();\n            let cssVal = obj[key];\n            cssText += (cssKey + ':' + cssVal + ';')\n        }\n\n        return cssText;\n    }\n}\n\nexport const Debugger = {\n\n    errorCount: 1,\n\n    confData: {\n        needShow: true,\n        needReport: false,\n        method: 'post',\n        url: ''\n    },\n\n    init(options) {\n        if (options) {\n            this.confData = objectAssign(this.confData, options)\n        }\n        this.listenScriptError();\n    },\n\n    listenScriptError(){\n        let me = this;\n        window.addEventListener('error', function () {\n            me.log(arguments[0])\n        });\n    },\n    log(error){\n\n        let me = this;\n\n        error = objectAssign(error, me.confData);\n\n        if (me.isError(error)) {\n\n            error.message = me.getStackMessage(error.stack);\n            error.location = me.getStackLocation(error.stack);\n            new DebuggerInstance(error);\n\n        } else if (me.isEvent(error)) {\n            me.throwError()\n                .then(e => {\n                    var target = error.target;\n                    error.message = \"Resource Error: can't get \" + (target.src || target.href) + \".\";\n                    error.location = me.getStackLocation(e.stack);\n                    new DebuggerInstance(error);\n                });\n\n\n        } else if (me.isErrorEvent(error)) {\n\n            error.location = me.getStackLocation(error.error.stack);\n            new DebuggerInstance(error);\n\n        } else if (me.isXHR(error)) {\n\n            me.throwError()\n                .then(e => {\n                    error.message = \"AJAX Error: XMLHttpRequest failed. Did you use $.ajax? the Debugger can't get more detail from error callback. Please check your $.ajax settings.\"\n                    error.location = me.getStackLocation(e.stack);\n                    new DebuggerInstance(error);\n\n                })\n\n        } else if (me.isString(error)) {\n            me.throwError()\n                .then(e => {\n                    new DebuggerInstance({\n                        message: error,\n                        location: me.getStackLocation(e.stack)\n                    });\n                })\n\n        } else if (me.isUndefined(error)) {\n            me.throwError()\n                .then(e => {\n                    error.message = \"Params Error: Debugger.log(...) must have 1 param in it, but found none\";\n                    error.location = me.getStackLocation(e.stack);\n                    new DebuggerInstance(error);\n\n                });\n        } else {\n            me.throwError()\n                .then(e => {\n                    error.message = \"Unknown Error.\";\n                    error.location = me.getStackLocation(e.stack);\n                    new DebuggerInstance(error);\n                });\n        }\n    },\n    throwError(){\n        return new Promise(function (res, rej) {\n            try {\n                throw new Error();\n            } catch (e) {\n                res(e)\n            }\n        })\n\n    },\n    getStackMessage(stack){\n        let stackArr = stack.split(/\\n+/);\n        return stackArr[0].replace(/(^\\s+|\\s+$)/, \"\");\n    },\n    getStackLocation(stack){\n        let stackArr = stack.split(/\\n+/);\n        return stackArr[stackArr.length - 1].replace(/(^\\s+|\\s+$)/, \"\");\n    },\n    isError(error){\n        return error instanceof Error;\n    },\n    isEvent(error){\n        return error.constructor === Event;\n    },\n    isErrorEvent(error){\n        return error.constructor === ErrorEvent;\n    },\n    isProgressEvent(error){\n        return error.constructor === ProgressEvent;\n    },\n    isXHR(error){\n        return error.constructor === XMLHttpRequest;\n    },\n    isString(error){\n        return Object.prototype.toString.call(error) === \"[object String]\"\n    },\n    isUndefined(error){\n        return Object.prototype.toString.call(error) === \"[object Undefined]\"\n    }\n\n};"]}